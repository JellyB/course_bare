package com.huatu.tiku.course.test;

import com.alibaba.fastjson.JSONObject;
import com.huatu.common.test.BaseWebTest;
import com.huatu.common.utils.encrypt.SignUtil;
import com.huatu.common.utils.reflect.BeanUtil;
import com.huatu.tiku.common.bean.reward.RewardMessage;
import com.huatu.tiku.common.consts.RabbitConsts;
import com.huatu.tiku.course.common.NetSchoolConfig;
import com.huatu.tiku.course.util.Crypt3Des;
import com.huatu.tiku.course.util.RequestUtil;
import lombok.extern.slf4j.Slf4j;
import org.junit.Test;
import org.springframework.amqp.rabbit.core.RabbitTemplate;
import org.springframework.beans.factory.annotation.Autowired;

import java.time.LocalDate;
import java.util.Arrays;
import java.util.List;
import java.util.Map;

/**
 * 描述：
 *
 * @author biguodong
 * Create time 2019-04-19 1:30 PM
 **/

@Slf4j
public class RewardServiceTest extends BaseWebTest {

    @Autowired
    private RabbitTemplate rabbitTemplate;


    @Test
    public void testReward(){

    	String userList = "htwxm_4299109,app_ztk1109980859,app_ztk2111292252,app_ztk358689807,app_ztk178878513,htwx_2880096,app_ztk1692026012,ht_9899608,app_ztk25569113,app_ztk961583227,15041217608,app_ztk1386738105,13534483968,app_ztk751389576,app_ztk1830708398,13190805695,htwx_7582983,ht_6860111,app_ztk1807888809,app_ztk1858678238,app_ztk1730133158,app_ztk563058616,18875276971,xue_19817555645,htwx_6894840,xue_18474765820,app_ztk690130686,app_ztk550269206,app_ztk1805878889,app_ztk1691856211,app_ztk1882660881,app_ztk91837981,live10691464,htwxmm_6823654,xue_app_15766752255,xue_app_18487403937,app_ztk1805868381,app_ztk1709010736,xue_web_18298762538,app_ztk839227517,app_ztk81733701,app_ztk822236958,xue_wap_18370239199,18669327313,app_8968505,app_ztk380908131,app_ztk77938577,httk_8500776,app_ztk1353869613,xue_app_15054893182,xue_app_18313743395,app_ztk1191818006,app_ztk1727908703,app_ztk1105073098,app_ztk1638736888,app_ztk158360371,app_ztk1850730882,htwxmm_6540529,app_ztk123998718,app_ztk88053797,app_ztk718828055,app_ztk653271286,app_ztk280598769,app_ztk38037802,app_8830693,xue_web_13832460523,app_ztk812698519,15001352614,app_8883929,htwxm_4923861,302735139,app_ztk1687150713,app_ztk1005569588,app_ztk583096885,xue_app_13649656133,dbxue13015727757,htwxm_4652432,httk_8954594,xue_wap_13488072658,app_ztk1158388939,httk_9163601,htwx_3266629,app_ztk1879669850,htwxm_4500348,htwx_3037577,app_ztk1165985589,httk_9030281,app_ztk1787253785,app_ztk1360998968,app_ztk689838821,xue_app_15605178277,htwx_5843496,xue_app_13072463495,app_ztk1182017022,13152668648,app_ztk1100222703,app_ztk1818897106,htwxmm_6810699,app_ztk2139183833,app_ztk751068178,app_ztk1265136573,app_ztk789118259,app_ztk1296935063,xue_app_15109169731,app_ztk918227826,app_ztk99936705,app_ztk1933760382,app_ztk309583877,app_ztk669385708,app_ztk1788098109,app_ztk1830967003,app_ztk1353128885,app_ztk598593237,app_ztk338888566,app_ztk2091878859,app_ztk2012830087,app_ztk156698929,app_ztk961758200,app_ztk2138588150,app_ztk888818568,htwxmm_7179902,xue_app_15807153097,app_ztk720788789,app_ztk636863623,xue_app_17508497661,app_ztk1282819375,httk_5519a513,app_ztk1761232202,app_ztk1588866821,app_ztk388838376,app_ztk1898526938,ht_6241124,htwx_6954526,app_ztk1209770187,htwx_6826975,app_ztk698577787,xue_app_18630558797,ht_3087414,15853117537,xue_15969747599,app_ztk1813818225,app_ztk1018759663,httk_55d41e45b80b4,live77518832,ht_8327387,app_ztk1656319852,xue_app_18275323463,app_ztk988257388,app_ztk592983978,xue_app_15146841231,13664318305,15903698122,app_ztk1388261289,app_ztk1186251595,httk_5505c7d6,app_ztk1518833191,app_ztk1858809639,app_ztk1053360827,app_ztk1172263383,ht_8592763,app_ztk1763767623,app_ztk625339371,htwx_5153945,app_ztk658587683,app_ztk960177668,httk_566eb43cdf620,app_ztk1511295986,app_ztk992058281,htwxmm_6708202,htwxmm_7996299,app_ztk1889986282,18366156172,app_ztk1688128630,httk_54dabce3,htwx_6825273,app_ztk816112028,app_ztk753016802,app_ztk1026108885,xue_app_15901501007,app_ztk886567888,app_ztk1671770275,app_ztk855319628,htwx_7926898,htwxm_4536656,app_ztk2108098085,app_ztk336387821,app_ztk288285036,13912372657,xue_app_15188112919,app_ztk296261185,app_ztk378137577,app_ztk1616536101,app_ztk61697131,httk_58ccec42d3ab0,13419682415,app_ztk677909665,app_ztk931808709,app_ztk1068556675,htwx_3319721,13541152646,htwx_8775294,ht_67814557,ht_5500044,app_ztk1572866087,app_ztk628762800,app_ztk2039198108,app_8373628,app_ztk1889003263,xue_app_15939275241,app_ztk1368502853,httk_550ac04c,xue_app_18253627782,app_ztk195372376,xue_app_15659889965,htwx_3831134,13687717801,13997082607,xue_app_15927173483,app_ztk161879602,app_ztk168830268,httk_581d9097969ed,app_ztk790891228,app_ztk1999386860,app_ztk636987682,18447052733,app_ztk519119825,app_ztk902718898,app_ztk68189865,htwxm_4934845,app_ztk1872576178,app_ztk600802539,app_ztk1878253796,app_ztk2128871222,xue_app_13696939935,app_ztk1882281089,ht_2140737,htwx_3122189,15996192730,httk_2910991,app_ztk1839693901,app_ztk912826792,xue_app_15035973231,httk_5762a83a7aead,18757973993,httk_55407d76,app_ztk1829719003,htwxmm_6470987,xue_app_15282782071,app_ztk1898318850,app_ztk1333381718,七爷公子策,htwx_5126925,app_ztk1113101822,app_ztk1088606897,app_ztk231886392,xue_app_17626678759,app_ztk230628856,app_ztk335990198,htwx_4894116,app_ztk399510016,app_ztk1190201298,13155528557,018359552776,htwxmm_8553554,app_ztk1275807269,15205008628,app_ztk2116038828,app_ztk1326705388,app_ztk1519896871,app_ztk810550909,app_ztk786358829,13873518070,app_ztk559578979,app_ztk2113306223,app_ztk1536737370,app_ztk831537678,httk_593dc9b1ee504,app_ztk878832326,app_ztk1306662008,app_9279938,xue_web_15650569852,app_ztk382389829,app_ztk713391816,15953979219,app_ztk705356819,htwx_5199329,app_ztk888875883,app_ztk335322328,13408800356,xue_dbm_17605523063,app_ztk1582310292,app_ztk1886352166,app_ztk1815581101,15148800941,app_9002366,15251702213,httk_587d83302cac5,app_ztk1251951095,app_ztk1866382681,app_ztk1836877870,live76402650,app_ztk2066209865,htwx_8162521,app_ztk1709008597,app_ztk893623832,app_ztk2091010168,app_ztk978156353,app_ztk2061210678,htwx_6862065,13756863388,app_ztk322366758,htwx_8341156,app_ztk22298832,app_ztk1928726258,013502976961,xue_18642993560,app_ztk1769368795,ht_2056733,ht_3906093,app_ztk1905573588,app_ztk570685658,app_ztk1766703565,app_ztk787701801,ht_6485596,dbxue18806520823,app_ztk1012810776,app_ztk1162066722,app_ztk198082813,app_ztk1866752812,18635852353,15034287953,htwx_7946507,app_ztk1170980521,ht_9682333,18205138127,xue_wap_15288457904,app_ztk1362820779,xue_app_13244039345,13466701039,15271841385,17367171366,app_ztk886287806,app_ztk287205882,httk_580461ce87e02,htwx_3948934,httk_57faddde1d775,app_ztk873817053,htwx_7672571,httk_5662df9ddbd6g,app_ztk2081337899,app_ztk281867315,ht_8912237,app_ztk1995025778,app_ztk1362077968,17805939831,app_ztk236913985,httk_57ad2a013fe8b,app_ztk1708081892,app_ztk638131107,app_ztk1972988609,app_ztk866685329,htwx_8122765,app_ztk250392788,httk_551153a9,app_ztk1108390836,xue_web_17747610289,app_ztk588376576,100xue,xue_app_15911880237,app_ztk38998518,app_ztk329681319,app_ztk738688888,13605572671,app_ztk2126832556,app_ztk887157771,xue_18798010082,app_ztk66582513,app_ztk1822895682,httk_8537118,app_ztk982837233,app_ztk1098086757,ht_3784241,htwxm_3546610,xue_app_18736395244,app_ztk980538899,app_ztk1937868883,app_ztk700053528,app_ztk925593699,xue_18306814038,app_ztk1271125287,app_ztk780023857,app_ztk16128833,app_ztk822368819,app_ztk1979931377,app_ztk582385023,httk_561f29ad16302,15196444997,ht_63124961,app_ztk1581532221,xue_app_18600184244,xue_app_17865569670,live80391849,xue_app_18111012316,app_ztk2180517608,xue_app_18164680703,xue_app_15309561689,15900623681,app_ztk338588708,13996118003,app_ztk829681005,xue_app_13584972786,app_ztk826953038,app_ztk1131882633,app_ztk1136180528,app_ztk190968659,app_ztk636072081,app_ztk1159628501,app_ztk2113317588,13656221625,app_ztk1652518398,app_ztk1507803836,app_ztk502502676,httk_8256316,app_ztk386058228,app_ztk1558861829,xue_app_18204864605,xue_app_15928563510,htwx_7780375,app_ztk2119921859,app_ztk1802368379,xue_app_18936016386,app_ztk1899638866,htwx_4096211,xue_app_13308366149,app_553b9614,htwx_3789263,httk_9250319,app_ztk1323637085,app_ztk95102298,xue_app_17693381708,xue_app_13667161866,app_ztk867602088,app_ztk1725788365,app_ztk960212780,app_ztk776901255,app_ztk1168580290,app_ztk1725756982,xue_13821086534,015983594274,xue_web_18962579128,app_ztk880923788,htwx_8625932,app_ztk91879663,httk_55f185e489a8c,app_ztk826626203,app_ztk1803581589,app_ztk108812217,17080952174,015318003533,app_ztk57158510,app_ztk851778993,htwx_8128007,app_ztk1525098398,app_ztk1958885838,app_ztk776027303,httk_550a910e,app_ztk837986537,013674726352,app_ztk1506353913,xue_15004194028,app_ztk925826270,app_ztk801969932,app_ztk1777872531,xue_13329256287,app_ztk1616308728,xue_app_13992681777,xue_app_15201501065,app_ztk1579602769,htwx_2972699,18384384288,xue_app_17858262976,xue_web_17664141058,xue_app_15883295334,xue_app_18389831625,app_ztk233538638,app_ztk181860291,app_ztk73855521,015087049692,app_ztk686329267,18749265236,app_ztk199207313,app_ztk985317858,htwx_4970866,app_ztk1782786787,13578785891,app_ztk77908901,app_ztk101938929,app_ztk2068869806,htwx_3769857,app_ztk711780062,app_ztk757286195,app_ztk1186098725,app_ztk1961883790,xue_app_17388551152,app_ztk1789880178,xue_app_15823359745,httk_2968292,15856358016,app_ztk1080999309,app_ztk1189807731,015234281896,app_ztk1068730122,app_ztk875872109,app_ztk895699905,app_ztk1955096803,ht_3333209,app_ztk1165866709,xue_app_18709456512,app_ztk2036308810,app_ztk1086689392,httk_2946518,app_ztk883099536,app_ztk570665118,app_ztk2083186182,15364589104,xue_app_18607134570,htwx_6899964,app_ztk1399605526,htwx_3494673,httk_54a957b6,app_8686200,app_ztk1101668393,app_ztk1326811018,htwxmm_6287927,htwxmm_6156647,app_ztk660832225,htwxmm_6699735,app_ztk521289276,httk_589d4456727b3,app_ztk1207138733,app_ztk81892801,app_ztk1630189183,app_ztk388653695,app_ztk829899732,app_ztk1130053785,app_ztk1952178586,app_ztk1802215818,app_ztk625228797,httk_55534387,app_ztk1076716085,app_ztk211878871,app_ztk1216881301,app_ztk1056808299,htwxm_5166227,app_ztk1366576309,httk_567b8e4e8d885,htwx_6991167,app_ztk558367691,app_ztk1088333265,httk_8373195,xue_app_18365156966,18982005525,15259890736,httk_552b203b,018487281384,app_ztk1000339993,app_ztk1851825812,app_ztk1877238370,14759018450,htwxmm_8053724,app_ztk277856895,xue_app_18088081538,app_557567b2,xue_app_13722985012,app_ztk1170709715,app_ztk2039188326,app_ztk1720625756,xue_app_13393780005,app_ztk176122999,httk_55263658,app_8957616,ht_1490649,xue_app_18118208700,app_ztk2026866787,ht_3462112,app_ztk1123851813,app_ztk1706020897,xue_app_13888068530,htwx_6298493,15058169835,app_ztk339889828,13593758954,13007593301,xue_app_18645145486,app_ztk923705270,app_ztk523832306,app_ztk1183998137,app_ztk216583813,app_ztk2116113986,18810429228,winner3231,app_ztk1168261816,xue_app_15947703287,xue_app_18356057821,xue_18977659239,app_ztk1080630229,httk_8375168,app_ztk819856028,app_ztk208791532,app_ztk860198021,htwxmm_7111398,app_ztk838972516,app_ztk68822672,app_ztk1182328672,xue_13981327793,app_ztk519755137,app_ztk676109706,app_ztk1181182765,";
        //bizId=, action=, gold=500, experience=0, uid=0, uname=httk_58ccec42d3ab0, timestamp=1553779862910
    	Arrays.asList(userList.split(",")).forEach(userName->{
    		RewardMessage rewardMessage  = RewardMessage.builder()
                    .bizId(LocalDate.now().toString()+"_huifang")
                    .action("ACTIVTY")
                    .gold(500)
                    .experience(1)
                   // .uid(233982024)
                    .uname(userName)
                    .timestamp(System.currentTimeMillis())
                    .build();
    		log.info(rewardMessage.toString());
           rabbitTemplate.convertAndSend("", RabbitConsts.QUEUE_REWARD_ACTION, rewardMessage);
    		
    	});;
    	
    }

    @Test
    public void decryptMode() {
        RewardMessage rewardMessage  = RewardMessage.builder()
                .bizId("4001458,4001459,4001460")
                .action("ACTIVTY")
                .gold(5000)
                .experience(1000000)
                .uid(233982024)
                .uname("app_ztk802796288")
                .timestamp(1553779862920L)
                .build();


        Map<String,Object> params = BeanUtil.toMap(rewardMessage);
        params.remove("uid");
        params.put("origin",2);


        String sign = SignUtil.getPaySign(params, NetSchoolConfig.API_KEY);
        params.put("sign",sign);
        //添加金币
        log.info("用户:{} 添加金币, 请求参数:{}",rewardMessage.getUname(), RequestUtil.encryptParams(params));
        Map<String,Object> objectMap = RequestUtil.encryptParams(params);
        String p = String.valueOf(objectMap.get("p"));
        log.error("<<<<<<<<<<<<<<<<<<<<<<<<<<<<:{}", objectMap.get("p"));
        String pp =  Crypt3Des.decryptMode(p);
        log.error(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>:{}", pp);
    }
    
}
